<!DOCTYPE html>  <html> <head>   <title>index.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               index.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>MD2Character</h1>

<p>This is annoted source of the examples for <code>tQuery.MD2Character</code> plugin.
The live demo can be found <a href="../">here</a></p>             </td>             <td class="code">               <div class="highlight"><pre> </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>The 3D World</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>First we initialize the world in 3D.
With <code>tQuery.createWorld()</code>, we create a <code>tQuery.World</code>.
With <code>.boilerplate()</code>, we setup a boilerplate on this world. A boilerplate is
a fast way to get you started on the right foot. It is the <a href="http://learningthreejs.com/blog/2011/12/20/boilerplate-for-three-js/">learningthreejs
boilerplate for three.js</a>
With <code>.start()</code>, we start the rendering loop. So from now on, the world scene
gonna be rendered periodically, typically 60time per seconds.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">world</span>	<span class="o">=</span> <span class="nx">tQuery</span><span class="p">.</span><span class="nx">createWorld</span><span class="p">().</span><span class="nx">boilerplate</span><span class="p">().</span><span class="nx">start</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Change the background color. This confusing line ensure the background of the
3D scene will be rendered as <code>0x000000</code> color, aka black. We set a black
background to give an impression of night.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">world</span><span class="p">.</span><span class="nx">renderer</span><span class="p">().</span><span class="nx">setClearColorHex</span><span class="p">(</span> <span class="mh">0x000000</span><span class="p">,</span> <span class="nx">world</span><span class="p">.</span><span class="nx">renderer</span><span class="p">().</span><span class="nx">getClearAlpha</span><span class="p">()</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>The Lights</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Here we setup the lights of our scene. This is important as it determine how
your scene looks. We add a ambient light and 2 directional lights.
The ambient light is a dark grey, to simulate the lack of light during the night.
We setup a directional light in front colored redish.... This is like a setting sun.
In the opposite direction, we put another direction light, bluish. This is like
the moon. Well this was my rational :)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">tQuery</span><span class="p">.</span><span class="nx">createAmbientLight</span><span class="p">().</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">world</span><span class="p">).</span><span class="nx">color</span><span class="p">(</span><span class="mh">0x444444</span><span class="p">);</span>
<span class="nx">tQuery</span><span class="p">.</span><span class="nx">createDirectionalLight</span><span class="p">().</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">world</span><span class="p">).</span><span class="nx">position</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">color</span><span class="p">(</span><span class="mh">0xFF88BB</span><span class="p">).</span><span class="nx">intensity</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">tQuery</span><span class="p">.</span><span class="nx">createDirectionalLight</span><span class="p">().</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">world</span><span class="p">).</span><span class="nx">position</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">color</span><span class="p">(</span><span class="mh">0x4444FF</span><span class="p">).</span><span class="nx">intensity</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>The fog</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>We had a fog to the scene.
For that, we use <code>tquery.world.createfog.js</code> plugins.
It allows to create the 2 types of fog from three.js
: <a href="https://github.com/mrdoob/three.js/blob/master/src/scenes/FogExp2.js">fogexp2</a>
and
<a href="https://github.com/mrdoob/three.js/blob/master/src/scenes/Fog.js">fog</a>.
<code>density</code> is the density of the fog. 0.01 is very light, 0.9 is almost opaque.
In general, fogs are a nice visual trick. It is rather cheap to compute
and limits the depth of what you see.
It is a nice trick to hide the "end of the world" :)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">world</span><span class="p">.</span><span class="nx">addFogExp2</span><span class="p">({</span><span class="nx">density</span> <span class="o">:</span> <span class="mf">0.1</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h1>The Columns</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>initialize a material</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We will apply it to all the columns. It is <a href="http://en.wikipedia.org/wiki/Lambertian_reflectance">lambert lighting</a>
the <code>ambient</code> is the color which gonna be combined with be combined with the ambient
light we initialized on top. <code>color</code> will be combined with the
directional lights. and <code>map</code> gives the texture to use.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">material</span>	<span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">({</span>
	<span class="nx">ambient</span>	<span class="o">:</span> <span class="mh">0xFFFFFF</span><span class="p">,</span>
	<span class="nx">color</span>	<span class="o">:</span> <span class="mh">0xFFAAAA</span><span class="p">,</span>
	<span class="nx">map</span>	<span class="o">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ImageUtils</span><span class="p">.</span><span class="nx">loadTexture</span><span class="p">(</span><span class="s1">&#39;images/water.jpg&#39;</span><span class="p">)</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Build 15 Columns</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>loop over each column</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Create the cylinder. We pass some parameters to the contructor to setup
the size we see fit, and we add the material we want to apply on the
cylinder. Then we use <code>.addTo()</code> to add our object to
our <code>tQuery.World</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">column</span>	<span class="o">=</span> <span class="nx">tQuery</span><span class="p">.</span><span class="nx">createCylinder</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="nx">material</span><span class="p">).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">world</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Change the position of the column. We translate the column to build
a kind of alley. Thus the character will be able to run inside it :)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">column</span><span class="p">.</span><span class="nx">translateX</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">?</span> <span class="o">+</span><span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">translateY</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">translateZ</span><span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nx">i</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h1>The Ground</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>We create a large checkerboard with <code>tquery.checkerboard.js</code> plugin.
We scale the checkerboard to 100 per 100 units in the 3D world. Thus it is
quite large and disappears into the fog. It gives the cheap impression of
an infinite checkerboard.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">tQuery</span><span class="p">.</span><span class="nx">createCheckerboard</span><span class="p">({</span>
	<span class="nx">segmentsW</span>	<span class="o">:</span> <span class="mi">100</span><span class="p">,</span>	<span class="c1">// number of segment in width</span>
	<span class="nx">segmentsH</span>	<span class="o">:</span> <span class="mi">100</span>	<span class="c1">// number of segment in Height</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">world</span><span class="p">).</span><span class="nx">scaleBy</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h1>The Character</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>We use <code>tQuery.RatamahattaMD2Character</code> plugin. Its inherits from
<code>tQuery.MD2Character</code> plugin. All the configuration for this particular
character <code>ratamahatta</code> is already done for you.
We attach it to tQuery world.
Additionnaly we use <code>.hookKeyboard()</code> which bind arrow key to character moving.
This function is part of
<a href="../../tquery.md2character.ratamahatta.keyboard.js">keyboard plugins for ratamahatta</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">character</span>	<span class="o">=</span> <span class="k">new</span> <span class="nx">tQuery</span><span class="p">.</span><span class="nx">RatamahattaMD2Character</span><span class="p">().</span><span class="nx">attach</span><span class="p">(</span><span class="nx">world</span><span class="p">).</span><span class="nx">hookKeyboard</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Here we show an example of binding the "loaded" event.
It is notified once the whole characters data are loaded (texture, mesh for animations of
body and weapons). It just display the name of the available animations.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">character</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;loaded&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;list animmation&quot;</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">character</span><span class="p">.</span><span class="nx">_meshBody</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">animations</span><span class="p">))</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>We setup the user camera controls.
It will determine how the user camera will move in the world scene.
We use <code>tQuery.MD2Character.CameraControls</code> plugin made specially
for this case. With it, the camera will follow the MD2 character looking
at it from above.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">world</span><span class="p">.</span><span class="nx">setCameraControls</span><span class="p">(</span><span class="k">new</span> <span class="nx">tQuery</span><span class="p">.</span><span class="nx">MD2Character</span><span class="p">.</span><span class="nx">CameraControls</span><span class="p">(</span><span class="nx">character</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Change the Skin by Keyboard</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>hook a function in the rendering loop. This function will be executed everytime
the scene is rendered. Within this function, we will use <code>tQuery.Keyboard</code>
plugins to test the keyboard. if the key <code>s</code> is pressed, then use <code>character.setSkin()</code>
to change the skin of the character</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">world</span><span class="p">.</span><span class="nx">loop</span><span class="p">().</span><span class="nx">hook</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	<span class="kd">var</span> <span class="nx">keyboard</span>	<span class="o">=</span> <span class="nx">tQuery</span><span class="p">.</span><span class="nx">keyboard</span><span class="p">();</span>	<span class="c1">// get keyboard instance</span>
	<span class="k">if</span><span class="p">(</span> <span class="nx">keyboard</span><span class="p">.</span><span class="nx">pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span> <span class="p">){</span>		<span class="c1">// if the key &#39;s&#39; is pressed, change the skin</span>
		<span class="nx">character</span><span class="p">.</span><span class="nx">setSkin</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">5</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 